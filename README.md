# exeload1991
このプロジェクトの内容は1992年10月頃にIBM-PC上で作りました。  
PCのフロッピーディスク専用のオリジナルDOS『EXELOAD』のソースコードです。  
ゲーム専用OSです。  
8086アセンブラで作られています。  
1990年のPC−9801版EXELOADを元にIBM-PC用に修正して作りました。  
  
この文を書いている時点で、34年前のソースコードです。動作の保証はありません。  
参考用として参照してください。  
  
1991年12月29日作成の ”README.DOC” から引用して、ここに掲載します。  
  
ここから
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー

; "README.DOC" J-3100GS001 make by R.Hashimoto 1991/08/06  
;						1991/09/20  
;						1991/12/28  
  
  EXELOAD/world-PC ver0.25 (C) R.Hashimoto 1989,1990,1991 in tokyo japan.  
  PSHELL/world-PC ver0.13  (C) R.Hashimoto 1989,1990,1991 in tokyo japan.  

（０）	本製品は、使用時のライセンス料は無料です。

	コピーおよび配布なども自由です。
	改造、改良、組み込み、掲載も自由です。

	ただし、本プログラムのソースコードおよび
	実行形式ファイルなどの、著作権と配布の権利
	販売の権利を、阻害する行為は絶対にやめて下さい。

	本製品（ＥＸＥＬＯＡＤとＰＳＨＥＬＬ）
	は、今後もいっさいのライセンス料は無料にします。

	本製品を改造してオリジナルＤＯＳとして製品化して
	ジャンジャン売って一億円もうけても構いません。
	ただし、そのときはＥＸＥＬＯＡＤとＰＳＨＥＬＬの
	メッセージは使用しないでくださいね。

	制作者


（１）　はじめに

	本製品は、ＩＢＭ−ＰＣ上でゲームプログラムを
	修正無しで動かすためにつくられた

	ＥＸＥＬＯＡＤ／ｗｏｒｌｄ−ＰＣ ｖｅｒ０．２５
	ＰＳＨＥＬＬ／ｗｏｒｌｄ−ＰＣ　ｖｅｒ０．１３

	です。

	本品に含まれるソースリストは次のようなものです。

	¥IPLKIT		ＩＰＬＳＹＳ.ＥＸＥ   ＥＸＥＬＯＡＤを書き込むツール
	¥PSHELL		ＰＳＨＥＬＬ.ＥＸＥ   簡易ＤＯＳシステム用シェル
	¥PCTEST		ＩＰＬＴＳＴ.ＥＸＥ   ＩＰＬの実験プログラム
	¥BEEP		ＴＳＴＢＥＥＰ.ＥＸＥ ＢＥＥＰテストプログラム
	¥MOUSE		ＴＳＴＭＳ.ＥＸＥ     ＰＳ／２マウステストプログラム
	¥SYSTIMER	ＴＳＴＴＩＭ．ＥＸＥ  システムタイマ・テストプログラム

	ＤＯＳを利用する場合はＥＸＥＬＯＡＤと
	ＰＳＨＥＬＬを組み合わせて利用します。


（２）　ＤＯＳの組み込み手順

	大体の手順は

	１．システムを組み込みたいディスクをＦＯＲＭＡＴします。
	　　（これは標準ＤＯＳのＦＯＲＭＡＴコマンドを使用してください）

	２．ＩＰＬＳＹＳ．ＥＸＥを使って
	　　ＥＸＥＬＯＡＤ.ＳＹＳを組み込みます。

	３．ＰＳＨＥＬＬ.ＥＸＥをコピーします。

	と、なります。

	実際の手順をＤｙｎａＢｏｏｋ上で
	２ＤＤのディスクを使った例をつぎに
	示します。

	C:¥> FORMAT A:/3

	新しいフロッピーディスク（２ＤＤ）を装置 A: に挿入してください.
	準備ができたらキーをどれか押してください.

	フォーマッティング中．．．トラック番号（79），ヘッド番号（1）
	ディスクのボリューム・ラベルを入力してください
	（２バイト文字−５文字、１バイト文字−１１文字、省略−エンターキー）
	？J3100


	   730112 バイト：全ディスク空間
	   730112 バイト：使用可能ディスク空間

	別のフロッピーディスクをフォーマッティングしますか　＜Y／N＞？ N
	C:¥> IPLSYS

	IPLSYS/EXELOAD/world-PC ver0.25 (C) R.Hashimoto 1991 in tokyo japan.
	 media type 1=360KB,2=1.2MB,3=720KB,4=1.44MB['Q':exit]:3
	 system write FD drive number.['Q':exit]:1
	 system write ok? ['Q':exit]
	IPL code size=  469
	system code size= 4923
	IPL
	cylinder=    0
	head    =    0
	sector  =    1
	system
	cylinder=    0
	head    =    1
	sector  =    6
	cylinder=    0
	head    =    1
	sector  =    7
	.....
	head    =    1
	sector  =    5
	complete.

	C:¥> COPY PSHELL.EXE A:
        1 個のファイルをコピーしました.

	C:¥> DIR A:

	 装置 A: のディスクのボリュームラベルはありません.
	 ディレクトリは A:¥

	EXELOAD  SYS     4923
	PSHELL   EXE    54848  91-08-03  18:32
	        2 個のファイルがあります.
	   669696 バイトが使用可能です.

	C:¥>


（３）　プログラムの組み込み

	ＡＵＴＯＥＸＥＣ．ＥＸＥを
	自動立ち上げします。


（４）　ＤＯＳの仕様について

	このＤＯＳはまだ試作の領域を出ていない
	部分が多いので、サイズも大きく不安定な
	動作をすることがあると思いますが、随時
	対応していく予定なのでご了承ください。

	ＰＣ９８の１．２ＭＢ（１０２４バイトセクタ）の
	ディスクを読みたいときはＤＭＤコマンドを使って
	モードを強制的に切り替えてください。

	近いうちに漢字表示ドライバを組み込む予定ですが
	漢字フォントのライセンスが有料になってしまいますので
	フォントファイルの部分を切り放して別々に
	供給して行きたいと考えています。

	漢字フォントセットは０.３水準をサポートする予定です。


（５）　ファンクション２１Ｈ

	ＩＮＴ２１Ｈでサポートされる機能は
	次の通りです。


	プログラムの終了
		ＡＨ＝００Ｈ

	１文字出力
		ＡＨ＝０２Ｈ
		入力	DL : 出力する文字

	コンソール入出力
		ＡＨ＝０６Ｈ
		入力	DL : 0FFH ならば１文字入力 0FFH以外ならば
				DL=出力する文字
		出力	AL : 入力文字
			zf : off:入力なし,on:入力あり

	文字列の出力

		ＡＨ＝０９Ｈ
		入力	DS:DX : 文字列 ('$':文字列の終わり)

	文字列の入力

		ＡＨ＝０ＡＨ
		入出力	DS:DX : バッファ
			+0:最大入力文字列（ＣＲも含む）
			+1:実際の入力された文字数（ＣＲを含まない）
	        	+2:入力された文字列

	ディスクのリセット

		ＡＨ＝０ＤＨ

	ＦＣＢファイルオープン

		ＡＨ＝０ＦＨ
		入力	DS:DX : 初期化されたユーザＦＣＢ
		出力	AL    : 0=正常, FFh=ファイルがない


	ＦＣＢファイルクローズ

		ＡＨ＝１０Ｈ
		入力	DS:DX : オープン中のユーザＦＣＢ
		出力	AL    : 0=正常, FFh=クローズ出来ない

	ＦＣＢファイルＲＥＡＤ

		ＡＨ＝１４Ｈ
		入力	DS:DX : オープン中のユーザＦＣＢ
		出力	AL    : 0=正常
			      : 1=Ｅ．Ｏ．Ｆ（もう続きのデータは無い）
			      : 2=ディスクエラー
	ＤＴＡセット

		ＡＨ＝１ＡＨ
		入力	DS:DX : セットするＤＴＡのアドレス


	プロセスの常駐

		ＡＨ＝３１Ｈ
		入力	DX : 確保パラグラフ値

	ディスクの空き容量
		ＡＨ＝３６Ｈ
		入力	DL : 0=カレントドライブ,1=A:,2=B:...
		出力	AX : セクタ数／１クラスタ,ドライブが無効のときはFFFFh
			BX : 空きクラスタ数
			CX : バイト数／１セクタ
			DX : クラスタ数／１ドライブ

	ハンドルクリエイト

		ＡＨ＝３ＣＨ
		入力	DS:DX : ハンドル名
		出力	cf    : off:正常,on:異常
			AX    : cf=off: ファイルハンドル
				cf=on : 3=ハンドル名が無効

	ハンドルのオープン

		ＡＨ＝３ＤＨ
		入力	DS:DX : ハンドル名
		出力	cf    : off:正常,on:異常
			AX    : cf=off: ファイルハンドル
			      : cf=on : 2=ファイルがない

	ハンドルのクローズ

		ＡＨ＝３ＥＨ
		入力	BX : ファイルハンドル
		出力	cf : off:正常,on:異常
			AX : cf=on : 6=ファイルハンドルが無効

	ハンドルのＲＥＡＤ

		ＡＨ＝３ＦＨ
		入力	DS:DX : バッファのアドレス
			CX    : 読み込みバイト数
			BX    : ファイルハンドル
		出力	cf    : off:正常,on:異常
			AX    : cf=off: 読み込めたバイト数。ＥＯＦならば０
			      : cf=on : 6=ファイルハンドルが無効

	ハンドルのＷＲＩＴＥ

		ＡＨ＝４０Ｈ
		入力	DS:DX : データバッファのアドレス
			CX    : 書き込みバイト数
			BX    : ファイルハンドル
		出力	cf    : off:正常,on:異常
			AX    : cf=off: 書き込めたバイト数。
			      : cf=on : 6=ファイルハンドルが無効

	メモリの割り当て

		ＡＨ＝４８Ｈ
		入力	BX       : 割り当てるメモリサイズ（パラグラフサイズ）
		出力	cf       : off:正常,on:異常
			cf=0  AX : 割り当てられたフリーエリアの先頭セグメント
			cf=1  AX : 08H=空きメモリが足りない
			cf=1  BX : フリーエリアのサイズ（パラグラフサイズ）

	メモリの開放

		ＡＨ＝４９Ｈ
		入力	ES : 開放するメモリのパラグラフ値


	メモリの割り当ての変更

		ＡＨ＝４ＡＨ

		入力	ES	: メモリ領域のセグメント値
			BX	: 割り当てるメモリサイズ（パラグラフサイズ）
		出力	cf	: off:正常,on:異常
			cf=1 AX	: 08H=メモリが足りない
			cf=1 BX	: 最大サイズ（パラグラフサイズ）


	プロセスの終了

		ＡＨ＝４ＣＨ


	ＰＳＰアドレスの取得

		ＡＨ＝６２Ｈ

		出力	BX : ＰＳＰセグメント値


（６）　テクニカルメモ

	・本製品は標準ＤＯＳに見られるサブディレクトリィの
	　機能はありませんので、予めご了承下さい。

	・本製品を使用する場合は、８０８６マクロアセンブラの
	　知識が必要です。

	・ＥＸＥＬＯＡＤ．ＳＹＳはセクタ位置が決まっていますので
	　単体のコピーは出来ません。

	・ＰＳＨＥＬＬ．ＥＸＥは単体でのコピーが可能です。

	・ＰＳＨＥＬＬのコマンド

		ＤＩＲ		ディレクトリィ一覧（ワイルドカードは不可）
		ＴＹＰＥ	タイプ
		ＨＥＬＰ	コマンド一覧
		ＣＴＲＬ−Ｃ	強制終了
		ＣＴＲＬ−Ｓ	一時停止
		ＣＴＲＬ−Ｑ	一時停止の解除

	・本ソースプログラムはＭＡＳＭｖｅｒ５．１でアセンブル
	　できます。リンカはＯＰＴＬＩＮＫ（ＭＳ−ＬＩＮＫ）を使用しています。

	・構造体定義やレコード、マクロ内のＩＦ分等、
	　複雑な定義は一切使っていません。

	・ＭＡＫＥＦＩＬＥはＭＳ−ＭＡＫＥ(Version 4.07)で実行出来ます。

	・シェル上のコマンドはＨＥＬＰで一覧を見ることが出来ます。

	・標準ＤＯＳに見られるサブディレクトリィの機能はありません。

	・いまのところ、書き込み中／読み込み中の２つのハンドルのみ
	　サポートします。従って同時にオープンできるファイル数は
	　ＲＥＡＤ／ＷＲＩＴＥともに一つずつです。

	・メモリ管理が出来ますが、機構は単純なフラットなもので
	　ブロックは持っていません。下記の５つのパラメータのみで
	　管理されているだけです。

		"SSADRS.ASM"

		ADRS_MIN	; 空きエリア（パラグラフ）下限
		ADRS_MAX	; 空きエリア（パラグラフ）上限＋１ (A000H)
		ADRS_PSP	; ＰＳＰエリア（パラグラフ）
		ADRS_PNEXT	; プログラムの直後エリア（パラグラフ）
		ADRS_FRE	; 空きエリア（パラグラフ）先頭

（重要）・ＰＳＨＥＬＬのサイズ

		ＰＳＨＥＬＬ．ＡＳＭの約１６行目に
		ＰＳＨＥＬＬ．ＥＸＥのパラグラフサイズ
		が入っています。
		改造時にはリンクマップを参照して変更を
		忘れないようにして下さい。
		（若干の余裕を持たせるのがコツ）

		MY_SYSTEM_SIZE	EQU 01000H	;このプログラムのサイズ
							（パラグラフ）
		リンクマップ
		Start  Stop   Length Name                   Class
		00000H 023FFH 02400H CHASH1                 CHASH1
		02400H 05924H 03525H CODE                   CODE
		05930H 0CD2FH 07400H DATA                   DATA
		0CD30H 0D4FFH 007D0H STACK                  
		0D500H 0D58FH 00090H PALET                  PALET
		       ------これにＥＸＥのヘッダサイズを
		       加算したのがプログラムサイズです。

;  
;	end of "README.DOC"  
;  

ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
ここまで

r.h 2025/5/10
