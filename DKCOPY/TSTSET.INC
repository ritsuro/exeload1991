; "TSTSET.INC" PC-9801UV11 make by R.H 1989/10/24
;
;	E X E L O A D    p r i n t   m a c r o .
;
;
;
; public subroutine.


;	ＰＲ	”表示文字列”
;	（改行無しプリント）

PR	MACRO	STRING
	LOCAL	L1,L2
	PUSH	SI
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
	EVEN
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	SI,OFFSET L1
	CALL	PRINT
	POP	SI
	ENDM


;	ＰＲＦ	”表示文字列”
;	（改行有りプリント）

PRF	MACRO	STRING
	LOCAL	L1,L2
	PUSH	SI
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
	EVEN
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	SI,OFFSET L1
	CALL	PRINT
	POP	SI
	CALL	LFPRN
	ENDM


;	ＩＮＰ
;	（文字列の入力）　出力　ＤＳ：ＳＩ＝入力文字列用
;		内部バッファの先頭アドレス（NULL=end of string）

INP	MACRO	STRING
	LOCAL	L1,L2,L3,L4
	PUSH	SI
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
	EVEN
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	SI,OFFSET L1
	CALL	PRINT
	POP	SI
	CALL	INPUT
	CALL	LFPRN
	CMP	BYTE PTR [SI],'Q'	;exit.
	JE	L3
	CMP	BYTE PTR [SI],'q'	;exit.
	JE	L3
	JMP	L4
L3:
	RET
L4:
	ENDM


;	ＣＯＭＰ	”比較用文字列”
;	（ＤＳ：ＳＩとの比較）　入力　ＤＳ：ＳＩ＝比較対照文字列
;					（NULL=end of string）
;				出力　ｃｆ、ｚｆ

COMP	MACRO	STRING
	LOCAL	L1,L2
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
	EVEN
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	DI,OFFSET L1
	CALL	STRCMP
	ENDM


;	ＬＦ
;	（改行）

LF	MACRO
	CALL	LFPRN
	ENDM


;	ＰＲＶ	”表示文字列”，ＷＯＲＤ＿ＶＡＬ
;	（改行有りワード値プリント１０進）

PRV	MACRO	STRING,PARAM
	LOCAL	L1,L2
	PUSH	SI
	PUSH	DX
	PUSH	SI
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
	EVEN
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	SI,OFFSET L1
	CALL	PRINT
	POP	SI
	MOV	DX,PARAM
	CALL	DECSTR
	CALL	STRZTS	; zero to space. "00123" - > "  123"
	CALL	PRINT
	POP	DX
	POP	SI
	CALL	LFPRN
	ENDM


;	ＰＲＶＨ	”表示文字列”，ＷＯＲＤ＿ＶＡＬ
;	（改行有りワード値プリント１６進）

PRVH	MACRO	STRING,PARAM
	LOCAL	L1,L2
	PUSH	SI
	PUSH	DX
	PUSH	SI
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
	EVEN
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	SI,OFFSET L1
	CALL	PRINT
	POP	SI
	MOV	DX,PARAM
	CALL	HEXSTR
	CALL	PRINT
	POP	DX
	POP	SI
	CALL	LFPRN
	ENDM


;	ＰＲＶＢ	”表示文字列”，ＷＯＲＤ＿ＶＡＬ
;	（改行有りワード値プリント２進）

PRVB	MACRO	STRING,PARAM
	LOCAL	L1,L2
	PUSH	SI
	PUSH	DX
	PUSH	SI
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
	EVEN
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	SI,OFFSET L1
	CALL	PRINT
	POP	SI
	MOV	DX,PARAM
	CALL	BINSTR
	CALL	PRINT
	POP	DX
	POP	SI
	CALL	LFPRN
	ENDM


;	ＰＲＢＹＴＥ	”表示文字列”，ＢＹＴＥ＿ＶＡＬ
;	（バイト値プリント１０進）

PRBYTE	MACRO	STRING,PARAM
	LOCAL	L1,L2
	PUSH	SI
	PUSH	AX
	PUSH	SI
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	SI,OFFSET L1
	CALL	PRINT
	POP	SI
	MOV	DH,0
	MOV	DL,PARAM
	CALL	DECSTR
	CALL	STRZTS	; zero to space. "00123" - > "  123"
	ADD	SI,2
	CALL	PRINT
	POP	AX
	POP	SI
	ENDM

;	ＰＲＢＹＴＥＨ	”表示文字列”，ＢＹＴＥ＿ＶＡＬ
;	（バイト値プリント１６進）

PRBYTEH	MACRO	STRING,PARAM
	LOCAL	L1,L2
	PUSH	SI
	PUSH	AX
	PUSH	SI
	JMP	L2
DATA	SEGMENT	PUBLIC	'DATA'
L1	DB	STRING,0
	EVEN
DATA	ENDS
L2:	MOV	SI,OFFSET L1
	CALL	PRINT
	POP	SI
	MOV	AH,PARAM
	CALL	PRNAH	; print ah reg.
	POP	AX
	POP	SI
	ENDM

;	ＰＲＣＨ
;	（１キャラクタプリント）　入力　ＡＨ＝キャラクタコード

PRCH	MACRO
	LOCAL	L1
	PUSH	AX
	PUSH	BX
	PUSH	CX
	PUSH	DX
	CMP	AH,20H
	JNB	L1
	MOV	AH,'.'
L1:
	MOV	AL,AH
	CALL	CHPUT	;print of ascii character.
	POP	DX
	POP	CX
	POP	BX
	POP	AX
	ENDM


;	ＳＥＴＳ	文字列名
;	（ＤＳ：ＳＩの文字列を文字列名のエリアへコピー）
;		入力　ＤＳ：ＳＩ＝セット文字列

SETS	MACRO	SNAME
	LOCAL	L1,L2
	PUSH	ES
	PUSH	SI
	MOV	AX,DS
	MOV	ES,AX
	CLD
	MOV	DI,OFFSET SNAME
L1:	LODSB
	CMP	AL,' '		; space.
	JB	L2
	STOSB
	JMP	L1
L2:	POP	SI
	POP	ES
	ENDM

;	ＬＣ	Ｘ，Ｙ
;	テキスト表示座標

LC	MACRO	XX,YY
	PUSH	AX
	PUSH	BX
	MOV	AX,XX
	MOV	BX,YY
	CALL	LOCATE		; locate.
	POP	BX
	POP	AX
	ENDM

;	ＪＭＰＥＱ	ラベル

JMPEQ	MACRO	LBL
	LOCAL	L1
	JNE	L1
	JMP	LBL
L1:
	ENDM


;	ＪＭＰＮＥ	ラベル

JMPNE	MACRO	LBL
	LOCAL	L1
	JE	L1
	JMP	LBL
L1:
	ENDM

;	ＪＭＰＬ	ラベル

JMPL	MACRO	LBL
	LOCAL	L1
	JGE	L1
	JMP	LBL
L1:
	ENDM


;	ＪＭＰＧ	ラベル

JMPG	MACRO	LBL
	LOCAL	L1
	JLE	L1
	JMP	LBL
L1:
	ENDM


;	ＬＯＯＰＸ	ラベル

LOOPX	MACRO	LBL
	LOCAL	L1
	DEC	CX
	JZ	L1
	JMP	LBL
L1:
	ENDM

MOVX	MACRO	DEST,SOU
	MOV	AX,SOU
	MOV	DEST,AX
	ENDM

MOVXB	MACRO	DEST,SOU
	MOV	AL,SOU
	MOV	DEST,AL
	ENDM

CMPX	MACRO	DEST,SOU
	MOV	AX,SOU
	CMP	DEST,AX
	ENDM

ADDX	MACRO	DEST,SOU
	MOV	AX,SOU
	ADD	DEST,AX
	ENDM

SUBX	MACRO	DEST,SOU
	MOV	AX,SOU
	SUB	DEST,AX
	ENDM


CODE	SEGMENT	PUBLIC	'CODE'

	ASSUME	CS:CODE,DS:DATA,ES:CODE,SS:CODE

	EXTRN	PRNAH:NEAR
	EXTRN	PRINT:NEAR
	EXTRN	INPUT:NEAR
	EXTRN	DECSTR:NEAR
	EXTRN	STRDEC:NEAR
	EXTRN	HEXSTR:NEAR
	EXTRN	STRHEX:NEAR
	EXTRN	BINSTR:NEAR
	EXTRN	STRBIN:NEAR
	EXTRN	STRCMP:NEAR
	EXTRN	CLS:NEAR
	EXTRN	CSLON:NEAR
	EXTRN	CSLOFF:NEAR
	EXTRN	INPCHR:NEAR
	EXTRN	CHPUT:NEAR
	EXTRN	KESCAP:NEAR
	EXTRN	KEYLOD:NEAR
	EXTRN	PRNAB:NEAR
	EXTRN	LOCATE:NEAR
	EXTRN	LFPRN:NEAR
	EXTRN	D10STR:NEAR
	EXTRN	STRZTS:NEAR

CODE	ENDS

;
;	end of "TSTSET.INC"
;
